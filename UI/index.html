<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <meta content="Online Public Bus Transportation Booking Service" name="description">
    <meta content="Gildas Niyigena" name="author">
    <title>WayFarer - Welcome</title>
    <link href="./css/style.css" rel="stylesheet">
    <link href="./css/font-awesome.min.css" rel="stylesheet">
</head>
<body>
<div class="page-container">
    <nav class="client-nav">
        <div class="logo"></div>
        <div class="btn-wrapper">
            <div class="btn default btn-login" id="user-login">Test as User</div>
            <div class="btn default btn-login" id="admin-login">Test as Admin</div>
        </div>
    </nav>
    <div class="form-wrapper">
        <div class="auth-area">
            <h2 class="auth-title">Login</h2>
            <div class="msg msg-hidden" id="login_msg"></div>
            <form class="auth-form">
                <!-- <form action="test-login.php" class="auth-form">-->
                <p class="input-group">
                    <label for="login_username">Username</label>
                    <input id="login_username" name="login_username" placeholder="Enter your username" type="text">
                </p>
                <p class="input-group">
                    <label for="login_password">Password</label>
                    <input id="login_password" name="login_password" placeholder="Enter your password" type="password">
                </p>
                <p class="input-group checkbox-input-group">
                    <label class="checkbox-input" for="login_remember">Remember me
                        <input id="login_remember" name="login_remember" type="checkbox">
                        <span></span>
                    </label>
                </p>
                <p class="input-group login-submit">
                    <label for="login_submit">
                        <input class="submit-btn" id="login_submit" name="login_submit" type="submit" value="ENTER">
                    </label>
                </p>
            </form>
            <a class="switch-auth-btn" href="#">Don't have account yet?</a>
        </div>
        <div class="auth-area form-hidden">
            <h2 class="auth-title">Register</h2>
            <div class="msg msg-hidden" id="register_msg"></div>
            <form class="auth-form">
                <!-- <form action="test-register.php" class="auth-form">-->
                <p class="input-group">
                    <label for="register_username">Username</label>
                    <input id="register_username" name="register_username" placeholder="Enter your username"
                           type="text">
                </p>
                <p class="input-group">
                    <label for="register_email">Email</label>
                    <input id="register_email" name="register_email" placeholder="Enter your email" type="email">
                </p>
                <p class="input-group">
                    <label for="register_password">Password</label>
                    <input id="register_password" name="register_password" placeholder="Enter your password"
                           type="password">
                </p>
                <p class="input-group">
                    <label for="register_confirm_password">Confirm password</label>
                    <input id="register_confirm_password" name="register_confirm_password"
                           placeholder="Password confirmation"
                           type="password">
                </p>
                <p class="input-group register-submit">
                    <label for="register_submit">
                        <input class="submit-btn" id="register_submit" name="register_submit" type="submit"
                               value="Register">
                    </label>
                </p>
            </form>
            <a class="switch-auth-btn" href="#">Already have an account?</a>
        </div>
    </div>
    <footer class="footer">
        <p>
            &copy; Gildas Niyigena, <span id="year">2018</span>
        </p>
    </footer>
</div>
<script type="application/javascript">

    "use strict";

    // localStorage.removeItem('loggedUserId');
    // localStorage.setItem('loggedUserId', 2);
    const elById = (id) => document.getElementById(id);

    const isAnyUserLoggedId = (localStorage.getItem('loggedUserId'));

    let message;
    let messageBox = elById('login_msg');

    const buildMessage = (messageObj) => {
        if (typeof message.type === 'string') {
            if (message.type === 'success') {
                messageBox.classList.remove('msg-hidden');
                messageBox.classList.add('success');
                messageBox.innerHTML = message.text
            } else {
                messageBox.classList.remove('msg-hidden');
                messageBox.classList.add('error');
                messageBox.innerHTML = message.text
            }
        } else {
            messageBox.classList.add('msg-hidden');
            messageBox.classList.contains('error') && messageBox.classList.remove('error');
            messageBox.classList.contains('success') && messageBox.classList.remove('success');
            messageBox.innerHTML = ''
        }
    };

    if (!!isAnyUserLoggedId) {
        window.location.replace('dashboard.html');
    } else {
        const loginAdminBtn = elById('admin-login');
        const loginUserBtn = elById('user-login');

        localStorage.removeItem('loggedUserId');
        [loginAdminBtn, loginUserBtn].forEach(el => el.addEventListener('click', ev => {
            // fetch("./db.json").then(res => res.json()).then(db => {})
            localStorage.setItem('loggedUserId', (
                ev.target['id'] === 'admin-login' ? 1 : ( // If the clicked button is admin set the current user to admin
                    Math.floor(Math.random() * (10 - 2 + 1) + 2) // Other wise set to a rendom Other user (id = 2 -> 10)
                )
            ) + '');
            window.location.replace('dashboard.html');
        }));

        // In other to As the user to log with a click to
        // the 'ENTER AS A USER' OR 'ENTER AS ADMIN'
        if (!!(localStorage.getItem('needToBeLogged'))) {

            message = {
                type: 'error',
                text: 'Use the above buttons to access the Dasbor as "ADMIN" or "USER"'
            };
            buildMessage(message);
            localStorage.removeItem('needToBeLogged');
        }
    }

    // LOGIN / REGISTER switch
    const authSwitcherBtnElements = document.getElementsByClassName('switch-auth-btn');

    Array.from(authSwitcherBtnElements).forEach(btn => btn.addEventListener('click', () => {

        const authFormElements = document.getElementsByClassName('auth-area');
        Array.from(authFormElements).forEach(form => form.classList.toggle('form-hidden'));
    }));

    // AUTH FORM validation
    const submitBtnElements = document.getElementsByClassName('submit-btn');
    let formSubmitable = false;

    Array.from(submitBtnElements).forEach(btn => btn.addEventListener('click', (e) => {
        const target = e.target;
        const submitBtnType = target.id;

        // Login form
        if (submitBtnType === 'login_submit') {

            const userNameField = elById('login_username');
            const PasswordField = elById('login_password');

            if (userNameField.value === '') {
                message = {type: 'error', text: 'The username can not be empty'};
                formSubmitable = false
            } else if (userNameField.value.length < 2 || userNameField.value.length > 13) {
                message = {type: 'error', text: 'The username can only be between 3 and 12 characters'};
                formSubmitable = false
            } else if (PasswordField.value.length === '') {
                message = {type: 'error', text: 'Password can not be empty'};
                formSubmitable = false
            } else {
                formSubmitable = true
            }

        } else { // Register form

            const userNameField = elById('register_username');
            const EmailField = elById('register_email');
            const PasswordField = elById('register_password');
            const PasswordConfirmationField = elById('register_confirm_password');

            messageBox = elById('register_msg');

            if (userNameField.value === '') {
                message = {type: 'error', text: 'The username can not be empty'};
                formSubmitable = false
            } else if (userNameField.value.length < 2 || userNameField.value.length > 13) {
                message = {type: 'error', text: 'The username can only be between 3 and 12 characters'};
                formSubmitable = false
            } else if (EmailField.value.length === '') {
                message = {type: 'error', text: 'The email can not be empty'};
                formSubmitable = false
            } else if (EmailField.value.length < 2 || EmailField.value.length > 13) {
                message = {type: 'error', text: 'The email can only be between 3 and 12 characters'};
                formSubmitable = false
            } else if (PasswordField.value.length === '') {
                message = {type: 'error', text: 'Password can not be empty'};
                formSubmitable = false
            } else if (PasswordField.value.length < 6 || PasswordField.value.length > 50) {
                message = {type: 'error', text: 'The email can only be between 6 and 50 characters'};
                formSubmitable = false
            } else if (PasswordConfirmationField.value !== PasswordField.value) {
                message = {type: 'error', text: 'Password and Password Confirmation may be the same'};
                formSubmitable = false
            } else {
                message = {
                    type: 'success',
                    text: 'You successfully created an account, check your email box for confirmation.'
                };
                formSubmitable = true
            }
        }
        buildMessage(message);
    }));
    // Current year for copyright
    const currentTime = new Date();
    elById("year").innerHTML = currentTime.getFullYear();
</script>
</body>
</html>
